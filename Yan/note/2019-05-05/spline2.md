# 样条插值

## 1. 原理

假设有

$x: x_0<x_1<...<x_{n-1}<x_n$,

$y: y_0,y_1,...,y_{n-1},y_n$

![img](https://img-blog.csdn.net/20180111154334120?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvZGVyYW1lcjE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast)

## 2. 二阶样条曲线插值

### 2.1 定义

样条曲线是一个分段定义的公式，给定n+1个数据，共有n个区间，满足：

（1）曲线方程在节点处的值相等$S(x_i)=y_i$

（2）第一个端点及最后一个端点在曲线上

（3）导数$S'(x) $在【a,b】内连续，即$S(x)$曲线是光滑的

n个三次多项式分段可以写作：
$$
S_i(x)=a_i+b_ix_i+c_ix_i^2
$$
其中，$a_i,b_i,c_i$为未知系数

### 2.2求解样条曲线

​         样条曲线求解主要是构建$Ax=b$线性方程，其中$A$为系数矩阵，$x$为曲线的系数，$b$为y值，如果共有n个点，则需要获取3n个线性公式来求解系数。

1. 根据节点处相等列出等式，共有$2(n-1)$个
   $$
   a_1+b_1(x_1)+c_1(x_1)^2=f(x_1)\\
   a_2+b_2(x_1)+c_i(x_1)^2=f(x_1)\\
   a_2+b_2(x_2)+c_i(x_2)^2=f(x_2)\\
   a_3+b_3(x_2)+c_3(x_2)^2=f(x_2)\\\tag{1}
   ...\\
   a_{n-1}+b_{n-1}(x_{n-1})+c_{n-1}(x_{n-1})^2=f(x_{n-1})\\
   a_n+b_n(x_{n-1})+c_n(x_{n-1})^2=f(x_{n-1})\\
   $$

2. 过起终点，共有2个
   $$
   a_1+b_1(x_0)+c_1(x_1)^2=f(x_0)\\
   a_n+b_n(x_n)+c_n(x_n)^2=f(x_n)\tag{2}
   $$

3. 节点处一阶、二阶导... m阶导相等，共有$m(n-1)$个
   $$
   b_1+2\cdot c_1x_1=b_2+2\cdot c_2x_1\\
   b_2+2\cdot c_2x_2=b_3+2\cdot c_3x_2\\
   ...\\
   b_{n-1}+2\cdot c_{n-1}x_{n-1}=b_{n}+2\cdot c_{n}x_{n-1}
   $$

4. 起终点一阶导约束

   （1）自由边界

   即二阶导为0，$c_1=0$

   （2）固定边界

   二阶导为指定值，$c_1=m$

   （3）非节点边界

   指定样条曲线的三次微分匹配，即

经过以上四点约束，便可构建如下线性方程：
$$
\left[
 \begin{matrix}
   1 & x_1 & x_1^2 & 0 & 0 & 0 &...   &0&0&0 \\
   1 & x_1 & x_1^2 & 0 & 0 & 0 &...   &0&0&0 \\
   0 & 0 & 0 & 1 & x_2 & x_2^2 &...   &0&0&0 \\
   0 & 0 & 0 & 1 & x_2 & x_2^2 &...   &0&0&0 \\...\\
   0 & 0 & 0 & 0 & 0 & 0 &...& 1 & x_{n-1} & x_{n-1}^2 \\
   0 & 0 & 0 & 0 & 0 & 0 &...& 1 & x_{n-1} & x_{n-1}^2 \\
   1 & x_0 & x_0^2 & 0 & 0 & 0 &...   &0&0&0 \\
   0 & 0 & 0 & 0 & 0 & 0 &...& 1 & x_{n} & x_{n}^2 \\
   0 & 1 & 2 x_1 & 0 & 1 & 2 x_1 & ...   &0&0&0 \\...\\
   0 & 0 & 0 & 0 & 0 & 0 &...& 0 & 1 & 2x_{n-1} \\
   0 & 0 & 1 & 0 & 0 & 0 &...   &0&0&0 \\


  \end{matrix}
  \right] 
  
  \left[
 \begin{matrix}
   a_1 \\   b_1 \\   c_1 \\   a_2 \\   b_2 \\   c_2 \\   ...\\   a_{n-1} \\   b_{n-1} \\
   c_{n-1} \\   a_{n} \\   b_{n} \\   c_{n} \\
   
  \end{matrix}
  \right] =  
  \left[
 \begin{matrix}
   f(x1) \\   f(x1) \\   f(x2) \\   f(x2) \\      ...\\f(x_{n-1}) \\   f(x_{n-1})  \\ 
   f(x0) \\   f(x_n) \\
   0 \\...\\0\\
   m
  \end{matrix}
  \right] \tag{3}
$$

### 2.3 实例

### 2.3.1 公式推导

目标点：

| $x_i(i=0,1,2,3)$ | 3    | 4.5  | 7    | 9    |
| ---------------- | ---- | ---- | ---- | ---- |
| $y_i(i=0,1,2,3)$ | 2.5  | 1    | 2.5  | 0.5  |

根据约束1：
$$
a_1+b_1\cdot 4.5 +c_1\cdot 4.5 ^2=1\\
a_2+b_2\cdot 4.5+c_2\cdot 4.5^2=1\\
a_2+b_2\cdot 7 +c_2\cdot 7 ^2=2.5\\
a_3+b_3\cdot 7 +c_3\cdot 7 ^2=2.5\\\tag{1}
$$
根据约束2：
$$
a_1+b_1\cdot 3 +c_1\cdot 3 ^2=2.5\\
a_3+b_3\cdot 9+c_3\cdot 9^2=0.5\\
$$
根据约束3：
$$
b_1+2\cdot c_1 \cdot 4.5=b_2+2\cdot c_2 \cdot 4.5\\
b_2+2\cdot c_2 \cdot 7=b_3+2\cdot c_3 \cdot 7
$$
根据约束4：
$$
b_1 = 0
$$
得到如下线性方程：
$$
\left[
 \begin{matrix}
   1 & 4.5 & 4.5^2 & 0 & 0 & 0 & 0 & 0 & 0 \\
    0 & 0 & 0 &1 & 4.5 & 4.5^2 & 0 & 0 & 0 \\
   0 & 0 & 0 & 1 & 7 & 7^2 & 0 & 0 & 0 \\
   0 & 0 & 0 &  0 & 0 & 0 1 & 7 & 7^2 &\\
   1 & 3 & 3^2 & 0 & 0 & 0 &0&0&0 \\
   0 & 0 & 0 & 0 & 0 & 0 & 1 & 9 & 9^2 \\
   0 & 1 & 2 x_1 & 0 & 1 & 2 x_1 & 0 &0&0 \\
   0 & 0 & 0 & 0 & 1 & 2x_2 & 0 & 1 & 2x_2 \\
   0 & 0 & 1 & 0 & 0 & 0 &0&0&0 \\


  \end{matrix}
  \right] 
  
  \left[
 \begin{matrix}
   a_1 \\   b_1 \\   c_1 \\   a_2 \\   b_2 \\   c_2 \\        a_3 \\   b_3 \\   c_3 \\    
  \end{matrix}
  \right] =  
  \left[
 \begin{matrix}
   1 \\   1 \\  2.5 \\   2.5 \\    2.5 \\   0.5  \\ 
   0 \\   0\\
   0
  \end{matrix}
  \right] \tag{3}
$$

### 2.3.2 代码



## 3. 三阶样条曲线



